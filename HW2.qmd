---
title: "Exploring Environmental Justice in LA"
author: Henry Oliver
format: html
---

#### Background

Present-day environmental justice may reflect legacies of injustice in the past. The United States has a long history of racial segregation which is still visible. During the 1930’s the Home Owners’ Loan Corporation (HOLC), as part of the New Deal, rated neighborhoods based on their perceived safety for real estate investment. Their ranking system, (A (green), B (blue), C (yellow), D (red)) was then used to block access to loans for home ownership. Colloquially known as “redlining”, this practice has had widely-documented consequences not only for community wealth, but also health (1). Redlined neighborhoods have less greenery (2) and are hotter than other neighborhoods (3).

A recent study found that redlining has not only affected the environments communities are exposed to, it has also shaped our observations of biodiversity.4 Community or citizen science, whereby individuals share observations of species, is generating an enormous volume of data. Ellis-Soto and co-authors found that redlined neighborhoods remain the most undersampled areas across 195 US cities. This gap is highly concerning, because conservation decisions are made based on these data.


## Prepare environment
```{r}
# Load library
library(tidyverse)
library(here)
library(tmap)
library(stars)
library(sf)
library(spData)
library(janitor)
library(knitr)


# Read in data
# EJScreen - Census
ejscreen <- st_read(here::here('data/ejscreen/EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb')) %>% 
  clean_names() %>% 
  # Filter to LA County
  filter((st_abbrev == 'CA') & (cnty_name == 'Los Angeles County')) %>%
  select(shape_length, shape_area, Shape, id,
st_abbrev, cnty_name, region, acstotpop, lowincome, pm25)
  
# HOLC Redlining
holc <- st_read(here::here('data/mapping-inequality/mapping-inequality-los-angeles.json')) %>% 
  st_transform(crs = st_crs(ejscreen)) %>% # Transform CRS
  clean_names()
  
# Biodiversity observations
birds <- st_read(here::here('data/gbif-birds-LA/gbif-birds-LA.shp')) %>% 
  st_transform(crs = st_crs(ejscreen)) %>%  # Transform CRS
  clean_names()
  
```


## Historical Redlining Neighborhoods Map
```{r}
map1 <-
  tm_shape(holc) +
    tm_polygons(fill = 'grade',
                palette = c(
                  "A" = "lightblue",
                  "B" = "lightgreen",
                  "C" = "#FFFF66",
                  "D" = "#FA2A55")) +
  tm_title(text = "HOLC Grades in LA County",
            frame = FALSE)

map1
  

```

2) Create a table summarizing
- the percentage of census block groups that fall within each HOLC grade

```{r}
# Join ejscreen and holc by Shape (ejscreen) and geometry (holc)
joined = st_join(ejscreen, holc) %>%
  st_drop_geometry()

# Get the count of each grade / total census blocks
pct_A <- (sum(joined$grade == 'A', na.rm = TRUE) / nrow(joined)) * 100
pct_B <- (sum(joined$grade == 'B', na.rm = TRUE) / nrow(joined)) * 100
pct_C <- (sum(joined$grade == 'C', na.rm = TRUE) / nrow(joined)) * 100
pct_D <- (sum(joined$grade == 'D', na.rm = TRUE) / nrow(joined)) * 100
pct_na <- (sum(is.na(joined$grade)) / nrow(joined)) * 100

pct_df <- data.frame(grade = c('A', 'B', 'C', 'D', 'No Grade'),
                     percentage = c(pct_A, pct_B, pct_C, pct_D, pct_na))

pct_table <- kable(pct_df, col.names = c("Grade", "Percentage"), caption = "HOLC Grade Percentages in LA County")

pct_table
```



3) Create at least two visualizations summarizing current conditions (from the EJScreen data) within HOLC grades using the mean of the following variables (you may combine variables or create separate plots)

- % Low income
- percentile for pm25
- percentile for low life expectancy
```{r}



```



